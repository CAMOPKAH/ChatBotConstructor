# Chatbot Manager Engine - Readme

## Описание
Backend-приложение «Менеджер чат-бота», управляемое сценариями из базы данных.
Логика диалога не зашита в код, а хранится в таблице `blocks` и выполняется динамически.

## Функциональность
- Поддержка Telegram (через aiogram).
- Динамическое выполнение Python-кода для каждого шага диалога.
- Сохранение состояния пользователя (сессии) и переменных (анкета).
- Полное логирование всех сообщений (inbound/outbound) в таблицу `trace`.

## Структура БД
- `blocks`: Сценарии (код шагов).
- `user_sessions`: Текущий шаг пользователя.
- `user_params`: Сохраненные данные (ФИО, возраст и т.д.).
- `trace`: История сообщений.

## Для разработчика
### Добавление новых шагов
1. Откройте `seed.py` (или создайте админку).
2. Добавьте новый `Block`.
3. В поле `script_code` напишите логику:
   - `input_text`: текст от юзера.
   - `event`: 'message' или 'enter'.
   - `set_param(key, val)`: сохранить данные.
   - `go_to(id)`: переход к блоку ID.
   - `send_message(text)`: отправить ответ.

### Запуск
См. `install.txt`.

## Админ-панель
Веб-интерфейс для управления пользователями, редактирования сценариев и просмотра логов.

### Запуск
1. Запустите `run_admin.bat` (или `python admin.py`).
2. Откройте в браузере: http://127.0.0.1:8005

### Возможности
1. **Пользователи**: Просмотр, добавление, удаление, активация/деактивация бот-юзеров.
2. **Редактор**: Визуальный редактор блоков (перемещение, редактирование кода, просмотр связей).
3. **Трейс**: Просмотр логов сессий (входящие/исходящие сообщения).
